# 提交热力图优化说明

## 更新日期
2025-12-28

## 优化内容

### 1. 数据采集层改进
**文件**: `src/data_analyzer.py`

- 修改 `_generate_calendar_heatmap()` 方法，为每天添加更详细的统计信息：
  - **新增代码行数** (`additions`): 当天所有提交的新增代码总和
  - **删除代码行数** (`deletions`): 当天所有提交的删除代码总和
  - **最晚提交时间** (`latest_time`): 当天最后一次提交的具体时间

### 2. 前端展示优化
**文件**: `templates/report.html`

#### 样式改进
- **365天完整展示**: 默认展示全年每一天，而非仅展示有提交记录的日期
- **默认淡色**: 未提交的日期显示为淡色 (`rgba(255, 255, 255, 0.08)`)
- **颜色渐变**: 根据提交次数，工作日的颜色逐渐加深
  - Level 0: 淡色背景（无提交）
  - Level 1: 25% 透明度（1-2次提交）
  - Level 2: 45% 透明度（3-5次提交）
  - Level 3: 65% 透明度（6-10次提交）
  - Level 4: 90% 透明度（10+次提交）

#### 交互增强
- **鼠标悬停效果**: 悬停时单元格放大 1.5 倍并显示光晕效果
- **智能提示框 (Tooltip)**: 鼠标移动到某天时显示详细信息
  - 完整日期（含星期）
  - 提交次数
  - 新增代码行数
  - 删除代码行数
  - 最晚提交时间
  - 夜间提交标识（晚18:00-次日早06:00显示月亮图标🌙）

## 技术实现

### 数据结构
```json
{
  "date": "2024-01-15",
  "count": 5,
  "additions": 234,
  "deletions": 89,
  "latest_time": "22:34:56",
  "level": 2
}
```

### Tooltip 边界处理
- 自动检测屏幕边界，防止提示框超出可视区域
- 智能调整位置，确保最佳展示效果

## 效果预览

### 静态展示
- 完整的53列网格布局（代表一年的53周）
- 每个小方块代表一天
- 颜色深浅直观反映工作强度

### 交互效果
- 鼠标悬停时单元格放大
- 显示详细的工作统计信息
- 夜间加班用紫色高亮显示

## 优势

1. **信息完整性**: 展示全年365天，而非仅工作日
2. **视觉直观性**: 颜色深浅一目了然地展示工作节奏
3. **详细信息**: 鼠标悬停展示当天完整的工作指标
4. **加班识别**: 自动识别并标识夜间提交
5. **用户体验**: 流畅的动画和智能的提示框定位

## 使用说明

### 查看热力图
1. 访问个人年度报告页面
2. 滚动到"提交热力图"部分
3. 鼠标移动到任意日期查看详细信息

### 颜色含义
- **淡灰色**: 无提交记录
- **淡紫色**: 少量提交 (1-2次)
- **中紫色**: 中等提交 (3-5次)
- **深紫色**: 大量提交 (6-10次)
- **最紫色**: 高强度提交 (10+次)

## 兼容性

- 支持所有现代浏览器（Chrome、Firefox、Safari、Edge）
- 响应式设计，移动端自动调整为26列布局
- 不影响现有报告数据结构（向后兼容）
