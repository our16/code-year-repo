# ç™»å½•å’Œæƒé™ç®¡ç†åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å®Œæ•´çš„ç™»å½•è®¤è¯ç³»ç»Ÿï¼Œè®¿é—® `http://192.168.3.31:8000` éœ€è¦å…ˆç™»å½•ï¼Œåªæœ‰ `/report/*` è·¯å¾„å¯ä»¥æ— éœ€ç™»å½•è®¿é—®ã€‚

## ä¸»è¦åŠŸèƒ½

### 1. ç™»å½•ç³»ç»Ÿ
- **ç™»å½•é¡µé¢**ï¼š`/login` æˆ– `/login.html`
- **ä¼šè¯ç®¡ç†**ï¼šåŸºäºCookieçš„Sessionæœºåˆ¶
- **ä¼šè¯æœ‰æ•ˆæœŸ**ï¼š24å°æ—¶ï¼ˆæ¯æ¬¡æ´»åŠ¨è‡ªåŠ¨ç»­æœŸï¼‰
- **è®¤è¯æ–¹å¼**ï¼šç”¨æˆ·å+å¯†ç è®¤è¯

### 2. è·¯ç”±æƒé™
- **éœ€è¦ç™»å½•çš„è·¯å¾„**ï¼š
  - `/` - æ ¹è·¯å¾„ï¼ˆæ€»è§ˆé¡µï¼‰
  - `/api/*` - æ‰€æœ‰APIæ¥å£ï¼ˆé™¤äº†ç™»å½•å’ŒéªŒè¯ä¼šè¯ï¼‰
  - `/static/*` - é™æ€èµ„æº

- **æ— éœ€ç™»å½•çš„è·¯å¾„**ï¼š
  - `/report/*` - ä¸ªäººæŠ¥å‘Šé¡µé¢
  - `/login` - ç™»å½•é¡µé¢
  - `/api/login` - ç™»å½•API
  - `/api/validate-session` - ä¼šè¯éªŒè¯API

### 3. é€€å‡ºç™»å½•
- åœ¨æ€»è§ˆé¡µé¢ç‚¹å‡»"é€€å‡ºç™»å½•"æŒ‰é’®
- æ¸…é™¤æœ¬åœ°ä¼šè¯ä¿¡æ¯
- é‡å®šå‘åˆ°ç™»å½•é¡µé¢

## ä¿®æ”¹çš„æ–‡ä»¶

### [src/server.py](src/server.py)

#### 1. æ·»åŠ ä¼šè¯å­˜å‚¨ï¼ˆç¬¬29-31è¡Œï¼‰
```python
# ä¼šè¯å­˜å‚¨ï¼ˆç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨Redisç­‰ï¼‰
SESSION_STORE = {}
SESSION_TIMEOUT = 3600 * 24  # 24å°æ—¶
```

#### 2. ä¼šè¯ç®¡ç†æ–¹æ³•ï¼ˆç¬¬41-97è¡Œï¼‰
```python
def create_session(self, username):
    """åˆ›å»ºä¼šè¯"""

def validate_session(self, session_id):
    """éªŒè¯ä¼šè¯"""

def check_session(self):
    """æ£€æŸ¥è¯·æ±‚çš„ä¼šè¯"""

def require_login(self):
    """è¦æ±‚ç™»å½•ï¼Œè¿”å›Falseè¡¨ç¤ºéœ€è¦é‡å®šå‘åˆ°ç™»å½•é¡µ"""
```

#### 3. ç™»å½•APIï¼ˆç¬¬281-350è¡Œï¼‰
```python
def handle_login(self):
    """å¤„ç†ç™»å½•è¯·æ±‚"""
    # éªŒè¯ç”¨æˆ·åå¯†ç 
    # åˆ›å»ºä¼šè¯
    # è®¾ç½®Cookie
```

#### 4. éªŒè¯ä¼šè¯APIï¼ˆç¬¬352-383è¡Œï¼‰
```python
def handle_validate_session(self):
    """éªŒè¯ä¼šè¯"""
```

#### 5. è·¯ç”±é€»è¾‘ï¼ˆç¬¬178-241è¡Œï¼‰
```python
def do_GET(self):
    # ç™»å½•é¡µé¢ä¸éœ€è¦è®¤è¯
    if path == '/login' or path == '/login.html':
        self.serve_static_file('static/login.html')
        return

    # æ£€æŸ¥ç™»å½•æ€ï¼ˆé™¤äº†reportè·¯å¾„ï¼‰
    if not self.require_login():
        # æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
        self.send_response(302)
        redirect_url = f'/login?redirect={path}'
        self.send_header('Location', redirect_url)
        self.end_headers()
        return

    # æ ¹è·¯å¾„ - é‡å®šå‘åˆ°æ€»è§ˆé¡µ
    if path == '/' or path == '/index.html':
        self.serve_static_file('static/overview.html')
        return

    # ä¸ªäººæŠ¥å‘Šé¡µé¢ï¼ˆæ¸²æŸ“HTMLï¼‰- ä¸éœ€è¦ç™»å½•
    if path.startswith('/report/'):
        ...
```

#### 6. POSTè¯·æ±‚å¤„ç†ï¼ˆç¬¬243-279è¡Œï¼‰
```python
def do_POST(self):
    # ç™»å½•APIä¸éœ€è¦è®¤è¯
    if path == '/api/login':
        self.handle_login()
        return

    # éªŒè¯ä¼šè¯APIä¸éœ€è¦è®¤è¯
    if path == '/api/validate-session':
        self.handle_validate_session()
        return

    # å…¶ä»–POSTè¯·æ±‚éœ€è¦ç™»å½•
    if not self.require_login():
        self.send_json_response({
            'success': False,
            'message': 'è¯·å…ˆç™»å½•'
        })
        return
```

### [static/login.html](static/login.html)

æ–°å»ºç™»å½•é¡µé¢ï¼ŒåŒ…å«ï¼š
- å“åº”å¼è®¾è®¡
- ç”¨æˆ·å/å¯†ç è¾“å…¥æ¡†
- é”™è¯¯æç¤º
- ç™»å½•çŠ¶æ€æ£€æŸ¥
- è‡ªåŠ¨è·³è½¬åŠŸèƒ½

### [static/overview.html](static/overview.html)

#### ä¿®æ”¹å†…å®¹ï¼ˆç¬¬22-24è¡Œï¼‰
æ·»åŠ é€€å‡ºç™»å½•æŒ‰é’®ï¼š
```html
<button id="logoutBtn" class="logout-btn" onclick="logout()">
    ğŸšª é€€å‡ºç™»å½•
</button>
```

### [static/css/overview.css](static/css/overview.css)

#### æ·»åŠ é€€å‡ºæŒ‰é’®æ ·å¼ï¼ˆç¬¬41-76è¡Œï¼‰
```css
.generate-btn,
.rerun-btn,
.logout-btn {
    /* ç»Ÿä¸€æ ·å¼ */
}

.logout-btn {
    background: rgba(150, 150, 150, 0.2);
}

.logout-btn:hover {
    background: rgba(150, 150, 150, 0.4);
}
```

### [static/js/overview.js](static/js/overview.js)

#### æ·»åŠ é€€å‡ºç™»å½•å‡½æ•°ï¼ˆç¬¬695-713è¡Œï¼‰
```javascript
async function logout() {
    if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        return;
    }

    try {
        // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ä¼šè¯ä¿¡æ¯
        localStorage.removeItem('sessionId');
        localStorage.removeItem('username');

        // è·³è½¬åˆ°ç™»å½•é¡µ
        window.location.href = '/login';
    } catch (error) {
        console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
        window.location.href = '/login';
    }
}
```

## ä½¿ç”¨æµç¨‹

### 1. é¦–æ¬¡è®¿é—®
```
1. è®¿é—® http://192.168.3.31:8000
2. è‡ªåŠ¨é‡å®šå‘åˆ° /login
3. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ˆé»˜è®¤ï¼šadmin/adminï¼‰
4. ç™»å½•æˆåŠŸåè·³è½¬å›æ€»è§ˆé¡µé¢
```

### 2. è®¿é—®æŠ¥å‘Š
```
1. ç›´æ¥è®¿é—® http://192.168.3.31:8000/report/xxx
2. æ— éœ€ç™»å½•ï¼Œç›´æ¥æŸ¥çœ‹æŠ¥å‘Š
```

### 3. é€€å‡ºç™»å½•
```
1. åœ¨æ€»è§ˆé¡µé¢ç‚¹å‡»"é€€å‡ºç™»å½•"æŒ‰é’®
2. ç¡®è®¤é€€å‡º
3. è·³è½¬åˆ°ç™»å½•é¡µé¢
```

## å®‰å…¨ç‰¹æ€§

1. **Cookieè®¾ç½®**ï¼š
   - HttpOnlyï¼šé˜²æ­¢XSSæ”»å‡»
   - SameSite=Laxï¼šé˜²æ­¢CSRFæ”»å‡»
   - Path=/ï¼šå…¨ç«™æœ‰æ•ˆ

2. **ä¼šè¯ç®¡ç†**ï¼š
   - è‡ªåŠ¨è¿‡æœŸæœºåˆ¶
   - æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨ç»­æœŸ
   - æœåŠ¡ç«¯éªŒè¯

3. **å¯†ç ä¿æŠ¤**ï¼š
   - ä»é…ç½®æ–‡ä»¶è¯»å–
   - ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 

## é…ç½®è¯´æ˜

åœ¨ `config/config.yaml` ä¸­é…ç½®ç®¡ç†å‘˜è´¦å·ï¼š

```yaml
admin:
  username: admin
  password: your_password_here
```

å¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé»˜è®¤ä½¿ç”¨ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin`

## æ€§èƒ½ä¼˜åŒ–

### é¡µé¢æ‹†åˆ†
- HTMLã€CSSã€JSå·²ç»å®Œå…¨åˆ†ç¦»
- ä½¿ç”¨ç‹¬ç«‹æ–‡ä»¶åŠ è½½ï¼Œä¾¿äºç¼“å­˜
- æ— å¤–éƒ¨ä¾èµ–ï¼ˆç§»é™¤Google Fontsï¼‰

### èµ„æºåŠ è½½
- CSSç‹¬ç«‹æ–‡ä»¶ï¼š`/static/css/overview.css`
- JSç‹¬ç«‹æ–‡ä»¶ï¼š`/static/js/overview.js`
- ç³»ç»Ÿå­—ä½“ï¼š`-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif`

## æ³¨æ„äº‹é¡¹

1. **ä¼šè¯å­˜å‚¨**ï¼šå½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼Œé‡å¯æœåŠ¡å™¨ä¼šæ¸…ç©ºæ‰€æœ‰ä¼šè¯
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®ä½¿ç”¨Redisç­‰å¤–éƒ¨å­˜å‚¨
3. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨HTTPSä¿æŠ¤å¯†ç ä¼ è¾“
4. **å¯†ç å¼ºåº¦**ï¼šè¯·ä¿®æ”¹é»˜è®¤å¯†ç 

## æµ‹è¯•å»ºè®®

1. **ç™»å½•åŠŸèƒ½æµ‹è¯•**
   - è®¿é—®æ ¹è·¯å¾„ï¼ŒéªŒè¯æ˜¯å¦è·³è½¬åˆ°ç™»å½•é¡µ
   - è¾“å…¥é”™è¯¯å¯†ç ï¼ŒéªŒè¯é”™è¯¯æç¤º
   - è¾“å…¥æ­£ç¡®å¯†ç ï¼ŒéªŒè¯ç™»å½•æˆåŠŸ

2. **ä¼šè¯ä¿æŒæµ‹è¯•**
   - ç™»å½•ååˆ·æ–°é¡µé¢ï¼ŒéªŒè¯ä¿æŒç™»å½•çŠ¶æ€
   - ç­‰å¾…24å°æ—¶åéªŒè¯è‡ªåŠ¨è¿‡æœŸ

3. **æƒé™æµ‹è¯•**
   - æœªç™»å½•è®¿é—®APIï¼ŒéªŒè¯è¢«æ‹¦æˆª
   - ç›´æ¥è®¿é—®/report/è·¯å¾„ï¼ŒéªŒè¯æ— éœ€ç™»å½•

4. **é€€å‡ºç™»å½•æµ‹è¯•**
   - ç‚¹å‡»é€€å‡ºæŒ‰é’®ï¼ŒéªŒè¯æ¸…é™¤ä¼šè¯
   - é€€å‡ºåè®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢ï¼ŒéªŒè¯é‡æ–°è·³è½¬

5. **å±€åŸŸç½‘æµ‹è¯•**
   - ç¡®è®¤æ— å¤–éƒ¨èµ„æºå¼•ç”¨
   - ç¡®è®¤æ‰€æœ‰èµ„æºå¯ç¦»çº¿åŠ è½½
